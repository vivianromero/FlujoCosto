{% load crud_tags %}
{% load i18n %}
{% if confirm and object.estado == 1 and crud_perms.update and not object.error %}
    {% crud_nurl object_model "confirm" namespace as nurl %}
    <button
        hx-headers='{"event_action": "confirmed"}'
        hx-vals='{"event_action": "confirmed", "object": "{{ object }}" }'
        hx-post="{% url nurl pk=object.pk %}{{ getparams_hx }}"
        {% if hx_target %}hx-target="{{ hx_target }}" {% else %}hx-target="#table_content_documento_swap"{% endif %}
        {% if hx_swap %}hx-swap="{{ hx_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
        hx-trigger="confirmed"
        id="id_form_btn_confirm"
        is="{{ object }}"
        name="confirm"
        role="button"
{#        href="{% url nurl pk=object.pk %}{{ getparams_hx }}"#}
        class="confirm_href btn btn-primary"
        _="on load from closest <form/> or keyup or keydown or change from closest <form/> debounced at 100ms
            if (<[required]:invalid/>).length > 0
                add @disabled
                then exit
            end
            remove @disabled"
        disabled
    >
    <i class="fa fa-tasks"></i> Confirmar
</button>
{% endif %}
<script>
    document.querySelectorAll("button.confirm_href").forEach((ref) => {
        ref.addEventListener("click", function (e) {
            e.preventDefault()
            let record = '\n' + '{{ object }}'
            swal.fire({
                title: "¿Está seguro que desea confirmar " + record + '?',
                text: '¡Esta acción no podrá revertirse!',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: "Confirmar",
                cancelButtonText: 'Cancelar',
                backdrop: true,
                allowOutsideClick:()=>false,
                allowEscapeKey:()=>false
            }).then(function(result) {
                  if(result.isConfirmed) {
                      // e.detail.issueRequest(true) // use true to skip window.confirm
                      htmx.trigger(e.target, 'confirmed')
                  }
            })
        })
    })
</script>

