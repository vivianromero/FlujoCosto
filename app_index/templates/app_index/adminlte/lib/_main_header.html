{% extends 'adminlte/lib/_main_header.html' %}
{% load menu_generator %}
{% load adminlte_helpers i18n %}
{% load static %}

{% block left_navbar_links_home %}{% endblock left_navbar_links_home %}
{% block left_navbar_links_contacts %}{% endblock left_navbar_links_contacts %}
{% block left_navbar_links_others_period %}
{% endblock left_navbar_links_others_period %}

<style>
    .dropdown-submenu {
        position: relative;
    }

    .dropdown-submenu a::after {
        transform: rotate(-90deg);
        position: absolute;
        right: 6px;
        top: .8em;
    }

    .dropdown-submenu .dropdown-menu {
        top: 0;
        left: 100%;
        margin-left: .1rem;
        margin-right: .1rem;
        min-width: 15rem;
    }

</style>

{% block left_navbar_links_toggle_menu %}
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <i class="fa fa-bars" aria-hidden="true"></i>
        </a>
        {% get_menu 'NAV_LEFT_SIDEBAR' as left_sidebar_menu %}
        {% block main_header_menu_items %}
            <ul class="dropdown-menu dropdown-menu-multiple" aria-labelledby="navbarDropdownMenuLink" style="min-width: 15rem;">
                {% for item in left_sidebar_menu  %}
                    {% if item.submenu %}
                    	<li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-toggle" href="{{ item.url }}"
                               {% if item.hx_get %}hx-get="{{ item.hx_get }}"{% endif %}
                               {% if item.hx_swap %}hx-swap="{{ item.hx_swap }}"{% endif %}
                               {% if item.hx_form_target %}hx-target="{{ item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                               {% if item.hx_form_swap %}hx-swap="{{ item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                            >
                                <i class="{{ item.icon_class }}"></i> {{ item.name }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-multiple">
                                {% for sub_item in item.submenu %}
                                    {% if sub_item.submenu %}
                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item dropdown-toggle" href="{{ sub_item.url }}"
                                               {% if sub_item.hx_get %}hx-get="{{ sub_item.hx_get }}"{% endif %}
                                               {% if sub_item.hx_swap %}hx-swap="{{ sub_item.hx_swap }}"{% endif %}
                                               {% if sub_item.hx_form_target %}hx-target="{{ sub_item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                                               {% if sub_item.hx_form_swap %}hx-swap="{{ sub_item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                                            >
                                                <i class="{{ sub_item.icon_class }}"></i> {{ sub_item.name }}
                                            </a>
                                            <ul class="dropdown-menu dropdown-menu-multiple">
                                                {% for sub_sub_item in sub_item.submenu %}
                                                    {% if sub_sub_item.submenu %}
                                                        <li class="dropdown-submenu">
                                                            <a class="dropdown-item dropdown-toggle" href="{{ sub_sub_item.url }}"
                                                               {% if sub_sub_item.hx_get %}hx-get="{{ sub_sub_item.hx_get }}"{% endif %}
                                                               {% if sub_sub_item.hx_swap %}hx-swap="{{ sub_sub_item.hx_swap }}"{% endif %}
                                                               {% if sub_sub_item.hx_form_target %}hx-target="{{ sub_sub_item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                                                               {% if sub_sub_item.hx_form_swap %}hx-swap="{{ sub_sub_item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                                                            >
                                                                <i class="{{ sub_sub_item.icon_class }}"></i> {{ sub_sub_item.name }}
                                                            </a>
                                                            <ul class="dropdown-menu dropdown-menu-multiple">
                                                                {% for sub_sub_sub_item in sub_sub_item.submenu %}
                                                                    {% if sub_sub_sub_item.submenu %}
                                                                        <li class="dropdown-submenu">
                                                                            <a class="dropdown-item dropdown-toggle" href="{{ sub_sub_sub_item.url }}"
                                                                               {% if sub_sub_sub_item.hx_get %}hx-get="{{ sub_sub_sub_item.hx_get }}"{% endif %}
                                                                               {% if sub_sub_sub_item.hx_swap %}hx-swap="{{ sub_sub_sub_item.hx_swap }}"{% endif %}
                                                                               {% if sub_sub_sub_item.hx_form_target %}hx-target="{{ sub_sub_sub_item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                                                                               {% if sub_sub_sub_item.hx_form_swap %}hx-swap="{{ sub_sub_sub_item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                                                                            >
                                                                                <i class="{{ sub_sub_sub_item.icon_class }}"></i> {{ sub_sub_sub_item.name }}
                                                                            </a>
                                                                        </li>
                                                                    {% else %}
                                                                        <li>
                                                                            <a class="dropdown-item" href="{{ sub_sub_sub_item.url }}"
                                                                               {% if sub_sub_sub_item.hx_get %}hx-get="{{ sub_sub_sub_item.hx_get }}"{% endif %}
                                                                               {% if sub_sub_sub_item.hx_swap %}hx-swap="{{ sub_sub_sub_item.hx_swap }}"{% endif %}
                                                                               {% if sub_sub_sub_item.hx_form_target %}hx-target="{{ sub_sub_sub_item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                                                                               {% if sub_sub_sub_item.hx_form_swap %}hx-swap="{{ sub_sub_sub_item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                                                                            >
                                                                                <i class="{{ sub_sub_sub_item.icon_class }}"></i> {{ sub_sub_sub_item.name }}
                                                                            </a>
                                                                        </li> 
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </ul>
                                                        </li>
                                                     {% else %}
                                                        <li>
                                                            <a class="dropdown-item" href="{{ sub_sub_item.url }}"
                                                               {% if sub_sub_item.hx_get %}hx-get="{{ sub_sub_item.hx_get }}"{% endif %}
                                                               {% if sub_sub_item.hx_swap %}hx-swap="{{ sub_sub_item.hx_swap }}"{% endif %}
                                                               {% if sub_sub_item.hx_form_target %}hx-target="{{ sub_sub_item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                                                               {% if sub_sub_item.hx_form_swap %}hx-swap="{{ sub_sub_item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                                                            >
                                                                <i class="{{ sub_sub_item.icon_class }}"></i> {{ sub_sub_item.name }}
                                                            </a>
                                                        </li>   
                                                    {% endif %} 
                                                    
                                                {% endfor %}
                                                
                                            </ul>
                                        </li>
                                        
                                    {% else %}
                                        <li>
                                            <a class="dropdown-item" href="{{ sub_item.url }}"
                                               {% if sub_item.hx_get %}hx-get="{{ sub_item.hx_get }}"{% endif %}
                                               {% if sub_item.hx_swap %}hx-swap="{{ sub_item.hx_swap }}"{% endif %}
                                               {% if sub_item.hx_form_target %}hx-target="{{ sub_item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                                               {% if sub_item.hx_form_swap %}hx-swap="{{ sub_item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                                            >
                                                <i class="{{ sub_item.icon_class }}"></i> {{sub_item.name }}
                                            </a>
                                        </li>
                                    {% endif %} 
                                {% endfor %}
                            </ul>
                        </li>
                    {% else %}
                        <li>
                            <a class="dropdown-item" href="{{ item.url }}"
                               {% if item.hx_get %}hx-get="{{ item.hx_get }}"{% endif %}
                               {% if item.hx_swap %}hx-swap="{{ item.hx_swap }}"{% endif %}
                               {% if item.hx_form_target %}hx-target="{{ item.hx_form_target }}" {% else %}hx-target="#dialog"{% endif %}
                               {% if item.hx_form_swap %}hx-swap="{{ item.hx_form_swap }}" {% else %}hx-swap="outerHTML"{% endif %}
                            >
                                <i class="{{ item.icon_class }}"></i> {{ item.name }}
                            </a>
                        </li>
                    {% endif %} 
                    
                {% endfor %}
            </ul>
        {% endblock main_header_menu_items %}
    
    </li>
    <script>
        $('.dropdown-menu-multiple a.dropdown-toggle').on('click', function(e) {
            {#console.log(!$(this).next().hasClass('show'))#}
            if (!$(this).next().hasClass('show')) {
                $(this).parents('.dropdown-menu-multiple').first().find('.show').removeClass("show");
            }
            {#var $subMenu = $(this).next(".dropdown-menu");#}
            console.log($($(this).next(".dropdown-menu")[0]))
            $(this).next(".dropdown-menu-multiple").toggleClass('show')
            {#$subMenu.toggleClass('show');#}
    
    
            $(this).parents('li.nav-item.dropdown.show').on('hidden.bs.dropdown', function(e) {
                $('.dropdown-submenu .show').removeClass("show");
            });
    
    
            return false;
        });
    </script>
{% endblock left_navbar_links_toggle_menu %}

{% block user_menu_buttons %}
    <div class="row">
        <div class="col-sm-8">
            <a href="{% block change_password_url %}{% url 'app_index:usuario:password' %}{% endblock %}"
                class="btn btn-primary btn-flat">{% trans 'Change password' %}
            </a>
        </div>
        <div class="col-sm-4">
            <form action="{% url 'app_index:usuario:logout' %}" method="post">
            {% csrf_token %}
                <button class="btn btn-primary btn-flat" type="submit">{% trans 'Log out' %}</button>
            </form>
        </div>
    </div>


{#    <a href="{% block logout_url %}{% logout_url %}{% endblock %}"#}
{#            class="btn btn-primary btn-flat">{% trans 'Log out' %}#}
{#    </a>#}

{% endblock user_menu_buttons %}
{% block right_navbar_links_toggle_right_filter_menu %}
{% endblock right_navbar_links_toggle_right_filter_menu %}
