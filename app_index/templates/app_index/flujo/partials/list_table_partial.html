{% load crud_tags %}
{% load departamento_tags %}
{% load partials %}
{% load django_tables2 %}
{% load crispy_forms_filters %}
{% load crispy_forms_tags %}
{% load static %}
{% load i18n %}
{% load sweetify %}
{% sweetify %}


<div id="table_content_documento_swap">
    {% block table_navbar %}
        {% include 'app_index/cruds/list_table_navbar.html' %}
    {% endblock table_navbar %}
    {% block datatable %}
        <div class="shadow border dark:border border-gray-200 sm:rounded-lg max-h-[650px]" style="height: inherit;">
            {% render_table table %}
        </div>
    {% endblock datatable %}
    <script>
        window.data = {
            button_shift_class_container: '{{ table.button_shift_class_container|safe }}',
            js_swal_title: '{{ js_swal_title|safe }}',
            js_swal_text: '{{ js_swal_text|safe }}',
            js_swal_confirmButtonText: '{{ js_swal_confirmButtonText|safe }}',
            js_swal_cancelButtonText: '{{ js_swal_cancelButtonText|safe }}',
            js_process_date: '{{ fecha_procesamiento|date:'d/m/Y'|safe }}',
            js_htmx_departamento_trigger: '{{ htmx_departamento_trigger }}'
        }
        if (window.data.js_htmx_departamento_trigger === 'True' && window.data.js_process_date){
            let period = document.getElementById('id_fecha_documento_formfilter')
            $(period)[0].value = window.data.js_process_date + ' - ' + window.data.js_process_date
        }
        if (window.data.js_htmx_departamento_trigger === 'True' && !window.data.js_process_date){
            let period = document.getElementById('id_fecha_documento_formfilter')
            $(period)[0].value = ""
        }
        {#document.body.addEventListener("process_date", function(evt){#}
        {#    console.log('doing event way from list_table_partial')#}
        {#    evt.target.value = window.data.js_process_date + ' - ' + window.data.js_process_date#}
        {#})#}
        document.querySelectorAll("a.delete_href").forEach((ref) => {
            ref.addEventListener("click", function (e) {
                e.preventDefault()
                let record = "\n" + e.target.parentElement.attributes['is'].nodeValue
                swal.fire({
                    title: '¿Está seguro que desea eliminar este elemento: ' + record + '?',
                    text: '¡Esta acción no podrá revertirse!',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Confirmar Eliminar',
                    cancelButtonText: 'Cancelar',
                    backdrop: true,
                    allowOutsideClick:()=>false,
                    allowEscapeKey:()=>false
                }).then(function(result) {
                      if(result.isConfirmed) {
                          // e.detail.issueRequest(true) // use true to skip window.confirm
                          htmx.trigger(e.target, 'confirmed')
                      }
                })
            })
        })
        document.querySelectorAll("a.activar_href").forEach((ref) => {
            ref.addEventListener("click", function (e) {
                e.preventDefault()
                let record = "\n" + e.target.parentElement.attributes['is'].nodeValue
                swal.fire({
                    title: "¿Está seguro que desea activar " + record + '?',
                    text: e.target.parentElement.attributes['texto'].nodeValue,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: "Confirmar Activar",
                    cancelButtonText: 'Cancelar',
                    backdrop: true,
                    allowOutsideClick:()=>false,
                    allowEscapeKey:()=>false
                }).then(function(result) {
                      if(result.isConfirmed) {
                          // e.detail.issueRequest(true) // use true to skip window.confirm
                          htmx.trigger(e.target, 'confirmed')
                      }
                })
            })
        })

        document.querySelectorAll("a.confirm_href").forEach((ref) => {
            ref.addEventListener("click", function (e) {
                e.preventDefault()
                let record = "\n" + e.target.parentElement.attributes['is'].nodeValue
                swal.fire({
                    title: "¿Está seguro que desea confirmar " + record + '?',
                    text: e.target.parentElement.attributes['texto'].nodeValue,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: "Confirmar",
                    cancelButtonText: 'Cancelar',
                    backdrop: true,
                    allowOutsideClick:()=>false,
                    allowEscapeKey:()=>false
                }).then(function(result) {
                      if(result.isConfirmed) {
                          // e.detail.issueRequest(true) // use true to skip window.confirm
                          htmx.trigger(e.target, 'confirmed')
                      }
                })
            })
        })
        
        document.querySelectorAll("a.inicializar_href").forEach((ref) => {
            ref.addEventListener("click", function (e) {
                e.preventDefault()
                let record = "\n" + e.target.parentElement.attributes['is'].nodeValue
                swal.fire({
                    title: "¿Está seguro que desea inicializar el departamento " + record + '?',
                    text: e.target.parentElement.attributes['texto'].nodeValue,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: "Confirmar",
                    cancelButtonText: 'Cancelar',
                    backdrop: true,
                    allowOutsideClick:()=>false,
                    allowEscapeKey:()=>false
                }).then(function(result) {
                      if(result.isConfirmed) {
                          // e.detail.issueRequest(true) // use true to skip window.confirm
                          htmx.trigger(e.target, 'confirmed')
                      }
                })
            })
        })
    </script>
</div>

{#<div id="id_datatableversat_swap" hx-swap-oob="true">#}
{#{% block datatableversat %}#}
<div id="id_datatableversat_swap" class="shadow border dark:border border-gray-200 sm:rounded-lg max-h-[650px]" 
     style="height: inherit;" hx-swap-oob="true">
    {% if tableversat %} {% render_table tableversat %} {% endif %}
</div>
{#{% endblock datatableversat %}#}
{#</div>#}

<div class="card-header" id="id_card_header_departamentos" style="padding: 0;" hx-swap-oob="true">
    Listado de departamentos
     {% include 'app_index/partials/partialdef_templates.html#inicializar_departamento_partial' %}
</div>
